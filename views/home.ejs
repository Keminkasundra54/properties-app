<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Table Filter</title>
<link rel="stylesheet" type="text/css" href="/static/style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="/static/js/main.js"></script>
<script>
let selectedFiles = []
function onFileSelected(event){
	selectedFiles = event.target.files;
}

$(document).on('click', '.pushProperty', function(e) {
  e.preventDefault();
  var _id = $(this).attr('data-id');
  $.ajax({
    url: "/api/property/pushToHive",
    method: 'post',
    data: JSON.stringify({_id: _id}),
    contentType: 'json', //this is requireded please see answers above
    processData: false,
    success: function(result){

		console.log(result)

      // location.reload();
    },
	error:function(result){
		console.log("error", result)
	}
  });
});
  $(document).on('submit', 'form.propertyForm', function(e) {
  e.preventDefault();
  var data = getFormData($('form.propertyForm'));
  data['userId'] = 1;
  let idToUpdate = data._id;
  if (idToUpdate) {

  } else {
    delete data._id;
  }

const formdata = new FormData()

if (selectedFiles.length) {
      for (let i = 0; i < selectedFiles.length; i++) {
		console.log("selectedFiles", selectedFiles[i])
        formdata.append('image',selectedFiles[i]);
      }
}
formdata.append('address' ,  data.address);
formdata.append('price' , data.price);
formdata.append('marketingStatus' , data.marketingStatus);
formdata.append('owner' , data.owner);
formdata.append('letType' , data.letType);
formdata.append('minimumeTenancy' , data.minimumeTenancy);
formdata.append('userId' , data.userId);
const urlEncoded = new URLSearchParams(formdata).toString()
  $.ajax({
    url: idToUpdate ? "/api/property/update" : "/api/property/create",
    method: 'post',
    data: formdata,
    contentType: false, //this is requireded please see answers above
    processData: false,
    success: function(result){

		console.log(result)

      location.reload();
    },
	error:function(result){
		console.log("error", result)
	}
  });
})

function getFormData($form){
  var unindexed_array = $form.serializeArray();
  var indexed_array = {};

  $.map(unindexed_array, function(n, i){
      indexed_array[n['name']] = n['value'];
  });

  return indexed_array;
}
</script>
</head>
	<body>
		<section class="filter-sec">
			<div class="wrapper">
				<div class="filter-secInr">
					<div class="filter-row">
						<div class="filter-rowINr flex flex-wrap">
							<div class="ls-filter">
								<div class="filter-list">
									<div class="filter-listInr">
										<label class="filter-search">All Department</label>
										<ul>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
										</ul>
									</div>
								</div>
								<div class="filter-list">
									<div class="filter-listInr">
										<label class="filter-search">All Department</label>
										<ul>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
											<li>
												<span>lorem ispum</span>
											</li>
										</ul>
									</div>
								</div>
							</div>
							<div class="rs-filter">
								<div class="prperty-btn popupButton button">
									<a href="#popupButton"> Add Property</a>
								</div>
							</div>
						</div>
					</div>
					<div class="table-row">
						<div class="table-rowINr">
							<table width="100%" cellpadding="0" cellspacing="0" style="text-align: left;">
								<thead>
									<tr>
										<th>
											<input type="checkbox" name="Select All" value="Select All">
										</th>
										<th>
											Image
										</th>
										<th>
											Adress
										</th>
										<th>
											Price
										</th>
										<th>
											Marketing Status
										</th>
										<th>
											Owner / Landlord
										</th>
										<th>
											Neg / Office
										</th>
										<!-- <th>
											<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="12px" height="16px" viewBox="0 0 12 16" enable-background="new 0 0 12 16" xml:space="preserve"><path d="M2,0C0.9,0,0,0.9,0,2v12c0,1.1,0.9,2,2,2h8c1.1,0,2-0.9,2-2V5H8C7.4,5,7,4.6,7,4V0H2z M8,0v4h4L8,0z M6.8,12.8  c0,0.4-0.3,0.8-0.8,0.8s-0.8-0.3-0.8-0.8V9.6l-1,1c-0.3,0.3-0.8,0.3-1.1,0s-0.3-0.8,0-1.1l2.3-2.2c0.3-0.3,0.8-0.3,1.1,0l2.2,2.2  c0.3,0.3,0.3,0.8,0,1.1s-0.8,0.3-1.1,0l-1-1L6.8,12.8L6.8,12.8z"/></svg>
										</th>
										<th>
											<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="12px" height="16px" viewBox="0 0 12 16" enable-background="new 0 0 12 16" xml:space="preserve"><path d="M8,5C7.4,5,7,4.5,7,4V0H2C0.9,0,0,0.9,0,2v12c0,1.1,0.9,2,2,2h8c1.1,0,2-0.9,2-2V5H8z M8.8,10.5l-2.2,2.2  c-0.3,0.3-0.8,0.3-1.1,0l-2.2-2.2c-0.3-0.3-0.3-0.8,0-1.1c0.3-0.3,0.8-0.3,1.1,0l1,1V7.2c0-0.4,0.3-0.8,0.8-0.8s0.8,0.3,0.8,0.8v3.2  l1-1c0.3-0.3,0.8-0.3,1.1,0C9.1,9.8,9.1,10.2,8.8,10.5z M8,0v4h4L8,0z"/></svg>
										</th> -->
										<th>
											Let Type
										</th>
										<th>
											Minimum Tenancy
										</th>
										<th>
											Buttons
										</th>
									</tr>
								</thead>
								<tbody>
                  <% properties.forEach((item)=>{%>
                    <tr>
                      <td>
                        <input type="checkbox" name="Select All" value="Select All">
                      </td>
                      <td>
						<img src ="/profile/<%- item['image'][0] %>" alt="Table-img" width="50" height="50" loading="lazy">
						<!-- <img src="data:image/jpeg;base64,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" alt="Table-img" width="50" height="50" loading="lazy"> -->
					</td>
                      <td>
                        <%- item['address'] %>
                      </td>
                      <td>
                        $ <%- item.price %>

                      </td>
                      <td>
                        <%- item.marketingStatus %>
                      </td>
                      <td>
                        <%- item.owner %>
                      </td>
                      <td>
                        Rachel Thorntone <br>
                        Oakton Estates
                      </td>

                      <td>
                        <%- item.letType %>
                      </td>
                      <td>
                        <%- item.minimumeTenancy %> Months
                      </td>
                      <td>
                        <div class="buttonBox flex flex-wrap">
                          <div class="popupButton button">
                            <a href="#popupBox" class="popup" data-id="<%- item._id %>">
                              <svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m11.25 6c.398 0 .75.352.75.75 0 .414-.336.75-.75.75-1.505 0-7.75 0-7.75 0v12h17v-8.749c0-.414.336-.75.75-.75s.75.336.75.75v9.249c0 .621-.522 1-1 1h-18c-.48 0-1-.379-1-1v-13c0-.481.38-1 1-1zm1.521 9.689 9.012-9.012c.133-.133.217-.329.217-.532 0-.179-.065-.363-.218-.515l-2.423-2.415c-.143-.143-.333-.215-.522-.215s-.378.072-.523.215l-9.027 8.996c-.442 1.371-1.158 3.586-1.264 3.952-.126.433.198.834.572.834.41 0 .696-.099 4.176-1.308zm-2.258-2.392 1.17 1.171c-.704.232-1.274.418-1.729.566zm.968-1.154 7.356-7.331 1.347 1.342-7.346 7.347z" fill-rule="nonzero"/></svg>
                            </a>
                            <a class="pushProperty" href="#popupBox" data-id="<%- item._id %>">
                              Push
                            </a>
                          </div>
                          <!-- <div class="button">
                            <a href="#">
                              Remove
                            </a>
                          </div> -->
                        </div>
                      </td>
                    </tr>
                    <%});%>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
			<div class="popupSec" id="popupBox">
				<div class="popupsecinr">
					<div class="popupBoxs">
						<div class="closeBTn">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path d="M23 20.168l-8.185-8.187 8.185-8.174-2.832-2.807-8.182 8.179-8.176-8.179-2.81 2.81 8.186 8.196-8.186 8.184 2.81 2.81 8.203-8.192 8.18 8.192z"/></svg>
						</div>
						<div class="popupItem">
							<form class="propertyForm" enctype="multipart/form-data">
								<fieldset class="fieldset-onecolumn">
									<div class="form-field">
										<input type="text" name="price" placeholder="Price">
									</div>
								</fieldset>
								<fieldset class="fieldset-onecolumn">
									<div class="form-field">
										<input type="text" name="marketingStatus" placeholder="Marketing Status">
									</div>
								</fieldset>
								<fieldset class="fieldset-onecolumn">
									<div class="form-field">
										<input type="text" name="owner" placeholder="Owner / Landlord">
									</div>
								</fieldset>
								<fieldset class="fieldset-onecolumn">
									<div class="form-field">
										<input type="text" name="letType" placeholder="Let Type">
									</div>
								</fieldset>
								<fieldset class="fieldset-onecolumn">
									<div class="form-field">
										<input type="text" name="minimumeTenancy" placeholder="Minimum Tenancy">
									</div>
								</fieldset>
                                 <fieldset class="fieldset-onecolumn" style="display: none;">
									<div class="form-field">
										<input type="text" name="_id" placeholder="Minimum Tenancy">
									</div>
								</fieldset>
								<fieldset class="fieldset-onecolumn">
									<div class="form-field">
										<input type="text" name="address" placeholder="Address">
									</div>
								</fieldset>
								<fieldset class="fieldset-onecolumn">
									<div class="form-field">
										<input type="file" id="image" name="image" multiple="multiple" onchange="onFileSelected(event)"/>
									</div>
								</fieldset>
								<div class="submit-btn">
									<input type="submit" value="Submit">
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</section>
	</body>
</html>
